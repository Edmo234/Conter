<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home - Contador</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" /> 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body {
      background-color: #198754;
      color: white;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
   
    .borda-completa {
      background: white;
      color: #212529;
      border-radius: 30px;
      border: 1px solid #212529;
      margin: 3px 3px 3px 3px;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 10px 15px;
    }
    .cards-area {
      flex-grow: 1;
    }
    .card-resumo {
      border-radius: 20px !important;
      overflow: hidden;
      text-align: center;
      border: 1px solid #212529;
      margin-bottom: 15px;
    }
    .card-header {
      background-color: #e9ecef;
      user-select: none;
    }
    .card-body {
      background-color: #f8f9fa;
    }
    .rodape {
      display: flex;
      justify-content: center;
      padding: 10px 0 0 0;
    }
    .btn-add {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      font-size: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>

  <!-- Cabeçalho com botão Sair -->
  <div class="bg-success text-light cabecalho d-flex justify-content-between align-items-center">
    <h4 class="m-4">Home</h4>
    <div>
      <span id="nomeUsuario" class=" me-5"></span>
      <button id="btnSair" class="btn btn-danger fs-10 me-4 btn-sm">Sair</button>
    </div>
  </div>

  <!-- Conteúdo Principal -->
  <div class="borda-completa">

    <!-- Cards -->
    <div class="cards-area">
      <div class="row g-3">

        <div class="col-6">
          <div class="card card-resumo">
            <div class="card-header fw-bold">Valor Total</div>
            <div class="card-body">
              <p id="valorTotal" class="m-2 fs-5">R$ 0,00</p>
            </div>
          </div>
        </div>

        <div class="col-6">
          <div class="card card-resumo">
            <div class="card-header fw-bold d-flex justify-content-center align-items-center gap-1">
              <span>Mês </span>
              <select id="selectMes" class="form-select form-select-sm w-auto text-dark">
                <option value="-1">Todos</option>
                <option value="0">Jan</option>
                <option value="1">Fev</option>
                <option value="2">Mar</option>
                <option value="3">Abr</option>
                <option value="4">Mai</option>
                <option value="5">Jun</option>
                <option value="6">Jul</option>
                <option value="7">Ago</option>
                <option value="8">Set</option>
                <option value="9">Out</option>
                <option value="10">Nov</option>
                <option value="11">Dez</option>
              </select>
            </div>
            <div class="card-body">
              <p id="valorMes" class="m-0 fs-3">R$ 0,00</p>
            </div>
          </div>
        </div>

        <div class="col-6">
          <div class="card card-resumo">
            <div class="card-header fw-bold">Esta Semana</div>
            <div class="card-body">
              <p id="valorSemana" class="m-0 fs-5">R$ 0,00</p>
            </div>
          </div>
        </div>

        <div class="col-6">
          <div class="card card-resumo">
            <div class="card-header fw-bold d-flex justify-content-between align-items-center">
              <span>Hoje</span>
              <span id="dataAtual" class="text-muted fs-6"></span>
            </div>
            <div class="card-body">
              <p id="valorDia" class="m-0 fs-5">R$ 0,00</p>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Botão Adicionar -->
    <div class="rodape">
      <a href="add.html" class="btn btn-success btn-add" title="Adicionar Produto">
        <i class="bi bi-plus-circle"></i>
      </a>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Verifica usuário logado
    const usuario = JSON.parse(localStorage.getItem('usuarioLogado'));
    if (!usuario || !usuario.nome) {
      window.location.href = "index.html";
    } else {
      document.getElementById('nomeUsuario').textContent = usuario.nome;
    }

    // Botão Sair
    document.getElementById('btnSair').addEventListener('click', () => {
      localStorage.removeItem('usuarioLogado');
      window.location.href = 'index.html';
    });

    // Atualizar data do Card Hoje
    const dataHoje = new Date();
    const dia = String(dataHoje.getDate()).padStart(2, '0');
    const mes = String(dataHoje.getMonth() + 1).padStart(2, '0');
    const ano = dataHoje.getFullYear();
    const dataHojeISO = `${ano}-${mes}-${dia}`; // yyyy-mm-dd
    document.getElementById('dataAtual').textContent = `${dia}/${mes}/${ano}`;

    // Formatar valores para moeda brasileira
    function formatarValor(valor) {
      return 'R$ ' + valor.toFixed(2).replace('.', ',');
    }

    // Calcular totais dos produtos para diferentes períodos
    function calcularTotais(mesSelecionado = -1) {
      const produtos = JSON.parse(localStorage.getItem('produtos')) || [];
      const hoje = new Date();
      const inicioSemana = new Date(hoje);
      inicioSemana.setDate(hoje.getDate() - hoje.getDay()); // domingo da semana atual

      let total = 0, mesTotal = 0, semanaTotal = 0, diaTotal = 0;

      produtos.forEach(produto => {
        const valor = parseFloat(produto.valor);
        const dataProduto = new Date(produto.data);

        total += valor;

        if (mesSelecionado === -1) {
          // Todos do mês atual
          if (dataProduto.getFullYear() === hoje.getFullYear() && dataProduto.getMonth() === hoje.getMonth()) {
            mesTotal += valor;
          }
        } else if (dataProduto.getMonth() === mesSelecionado && dataProduto.getFullYear() === hoje.getFullYear()) {
          mesTotal += valor;
        }

        // Verifica se está dentro da semana atual (domingo até hoje)
        if (dataProduto >= inicioSemana && dataProduto <= hoje) {
          semanaTotal += valor;
        }

        // Verifica se é hoje (comparação de yyyy-mm-dd)
        const dataProdutoISO = dataProduto.toISOString().split('T')[0];
        if (dataProdutoISO === dataHojeISO) {
          diaTotal += valor;
        }
      });

      document.getElementById('valorTotal').textContent = formatarValor(total);
      document.getElementById('valorMes').textContent = formatarValor(mesTotal);
      document.getElementById('valorSemana').textContent = formatarValor(semanaTotal);
      document.getElementById('valorDia').textContent = formatarValor(diaTotal);
    }

    // Configura o select para mês atual
    const selectMes = document.getElementById('selectMes');
    selectMes.value = new Date().getMonth();

    selectMes.addEventListener('change', () => {
      calcularTotais(parseInt(selectMes.value));
    });

    // Calcula os totais inicial
    calcularTotais(selectMes.value);
  </script>
</body>
</html>
